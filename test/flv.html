<html>
  <head>
    <title>FLVのテスト</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <script type="text/javascript" src="../closure-library/closure/goog/base.js" ></script>
    <script type="text/javascript" src="../deps.js" ></script>
    <script type="text/javascript">
      goog.require("goog.testing.jsunit");
      goog.require("com.ttProject.channel.XhrIoReadChannel");
      goog.require("com.ttProject.container.flv.FlvTagReader");
      goog.require("com.ttProject.container.flv.FlvHeaderTag");
//      goog.require("com.ttProject.container.flv.FlvTagWriter");
    </script>
    <script type="text/javascript">
    function setUp() {
    }
    function tearDown() {
    }
    var i = 0;
    function test() {
//      writer = new com.ttProject.container.flv.FlvTagWriter();
      channel = new com.ttProject.channel.XhrIoReadChannel("../mario.flv");
      var reader = new com.ttProject.container.flv.FlvTagReader();
      readLoop = function() {
        reader.read(channel, function(unit) {
          console.log(unit);
          i ++;
          if(unit != null) {
            if(unit instanceof com.ttProject.container.flv.FlvHeaderTag) {
            }
            else {
            }
            if(i % 10 == 0) {
              console.clear();
              setTimeout(readLoop, 10);
            }
            else {
              readLoop();
            }
          }
          else {
            console.log("end...");
          }
/*          i ++;
          if(unit != null) {
            // 先頭のframeにはメタデータ的なものがはいっているみたいなので、それを除外してみた。
            if(unit.getPts() < 441000) {
              writer.addContainer(unit);
            }
            if(i % 10 == 0) {
              setTimeout(readLoop, 10);
            }
            else {
              readLoop();
            }
          }
          else {
            console.log(window.URL.createObjectURL(writer.getBlob()));
          }*/
        });
      }
      readLoop();
    }
    </script>
  </body>
</html>
